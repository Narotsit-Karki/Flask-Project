<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body>

{% extends 'layout.html' %}
{% block content %}
<style>
    .content-section{
        border-radius: 5px;
        background-color: #f2f2f2;
        padding: 5px;
        margin: 5%;
        # width: 100%;
       }

    .account-img{
        height: 125px;
        width: 125px;
        }
</style>

<div class = "content-section">
    <div class = "media">
            <img class= "rounded-circle account-img" src = "{{image_file}}">
            <div class = "media-body" style=" margin-left: 2%; position: relative;">

                <h2 class = "account-heading">
                        {{current_user.username}}
                </h2>
                <p class = 'text-secondary'> {{current_user.email}} </p>

            </div>
    </div>

<div class = "container">
    <form method = "POST" action="" enctype ="multipart/form-data">
         {{ form.hidden_tag() }}
<!--         adding csrf token-->
        <fieldset class = "form-group">
            <legend class = "border-bottom mb-4">
                Account Info
                <hr class="dashed">
                <div class = "form-group">
                    {{ form.username.label(class = "form-control-label") }}
                    {% if form.username.errors %}
                        {{ form.username(class = "form-control form-control-md is-invalid") }}
                        <div class = "invalid-feedback">
                            {% for error in form.username.errors %}
                                <span> {{ error }} </span>
                            {% endfor %}
                        </div>
                    {% else %}
                        {{ form.username(class = "form-control form-control-md", value = current_user.username) }}
                    {% endif %}

                </div>
                <div class = "form-group">
                     <div class = "form-group">
                    {{ form.email.label(class = "form-control-label") }}
                         {% if form.email.errors %}
                            {{ form.email(class = "form-control form-control-md is-invalid") }}
                        <div class = "invalid-feedback">
                            {% for error in form.email.errors %}
                                <span> {{ error }} </span>
                            {% endfor %}
                        </div>
                    {% else %}
                        {{ form.email(class = "form-control form-control-md",value = current_user.email) }}
                    {% endif %}
                </div>
                </div>
            </legend>
        </fieldset>
        <div class = "form-group" >
            {{ form.profile_pic.label() }}
            <br/>
            {{ form.profile_pic(class = "form-control-file primary", style = "padding: 1%;") }}
            {% if form.profile_pic.errors %}
                {% for error in form.profile_pic.errors %}
                   <br/> <span class="text-danger" style="margin-bottom: 1px;"> {{ error }} </span>
                {% endfor %}
            {% endif %}
        </div>
        <div class = "form-group" style="margin-left:1%;">
            {{ form.update(class = "btn btn-primary") }}
        </div>
    </form>
</div>
</div>
</body>
<body>
<body background="{{back_path}}">
<div class='container' style="padding: 1%;">
    <h2 class="text-muted" style = "text-align:center; color: white;">
        POSTS FROM YOU
    </h2>

    {% if current_user.is_authenticated %}
     <a href = "{{url_for('new_post') }}"><div class="fa fa-plus-circle" data-toggle="tooltip" data-placement="top" title="Add a new post" style="font-size:250%; color:white;"> </div> </a>
    {% endif %}
    {% for post in post_datas %}
    <div style="padding:2%;"></div>
    <div class="card text-black" style="...">
        <div class="card-body">
            <h5 class="card-title" style= "color:purple;">{{post.title}}</h5>
            <h6 class="card-subtitle mb-2 text-muted">
<!--                <form method='POST'>-->
                <img class= "rounded-circle account-img" src = '/static/profile_pics/{{post.author.image_file}}' style = "width: 55px; height: 55px;"> @<a href="#" name="Author">{{post.author.username}}</a>

<!--                </form>-->
            </h6>
            <h6 class="card-subtitle mb-1 text-muted">{{ post.date_posted.strftime('%B, %d %Y') }}</h6>

            <p class="card-text" style = "text-align: justify; letter-spacing: 1px;" id="content">{{post.content}}</p>



            <button type="button" class="btn" data-bs-toggle="collapse" data-bs-target=#post_{{post.id}}
                    aria-expanded="false" aria-controls="collapseExample">
                <i class = "fa fa-comments-o" style="font-size: 190%;color:purple"></i>
            </button>

            <div class="collapse" id= post_{{post.id}} style="padding : 1rem;">

                <div class="card card-body" style="padding: 1rem;">
                    <form method="POST" action="/create-comment/{{post.id}}">
                        <div class="input-group mb-3">
                            <input type = "text" id = "text" name = "text" class = "form-control form-control-md" placeholder=" Write your comment" required />
                            <button type = "submit" class = "btn btn-success">Submit</button>

                        </div>
            {% for comment in comments %}
                        {% if comment.post_id == post.id %}
                            <div class="collapse" id= post_1 style="padding : 1rem;">
                                <div class="card card-body" style="padding: 1rem;">
                                <h6 class="card-subtitle mb-1 text-muted"> <img class= "rounded-circle account-img" src = "/static/profile_pics/default.jpg" style = "width: 4%; height: auto;"> @{{ comment.comment_user.username }}</h6>
                                <h6 class="card-subtitle mb-0 text-muted">{{comment.date_commented.strftime('%B, %d %Y')}}</h6>
                                <p class="card-text">{{comment.comment}}</p>
                            </div>
                          </div>
                                {% endif %}
            {% endfor %}

                    </form>
                </div>

            </div>
        </div>
    </div>


    {% endfor %}
</div>




</body>
{% endblock content %}
</html>